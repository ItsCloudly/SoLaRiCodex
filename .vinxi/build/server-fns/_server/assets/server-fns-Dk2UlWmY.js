import{parseSetCookie as te}from"cookie-es";import{fromJSON as I,crossSerializeStream as se,getCrossReferenceHeader as re}from"seroval";import{CustomEventPlugin as $,DOMExceptionPlugin as w,EventPlugin as H,FormDataPlugin as C,HeadersPlugin as k,ReadableStreamPlugin as q,RequestPlugin as T,ResponsePlugin as A,URLSearchParamsPlugin as P,URLPlugin as E}from"seroval-plugins/web";import{lazy as ne,createComponent as oe,sharedConfig as G}from"solid-js";import{ssrElement as g,escape as ae,mergeProps as ie,ssr as ce,isServer as ue,getRequestEvent as le,renderToString as pe}from"solid-js/web";import{provideRequestEvent as X}from"solid-js/web/storage";import{H3Event as L,getRequestIP as de,parseCookies as fe,getResponseStatus as he,getResponseStatusText as me,getCookie as ge,setCookie as Re,getResponseHeader as ye,setResponseHeader as Se,removeResponseHeader as xe,getResponseHeaders as be,getRequestURL as ve,getRequestWebStream as $e,setResponseStatus as we,appendResponseHeader as He,setHeader as Ce,eventHandler as ke}from"h3";import{getContext as qe}from"unctx";import{AsyncLocalStorage as Te}from"node:async_hooks";import{createRouter as Ae}from"radix3";function Pe(e){let s;const t=J(e),n={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(t,{...n,body:e.node.req.body}):new Request(t,{...n,get body(){return s||(s=Me(e),s)}})}function Ee(e){return e.web??={request:Pe(e),url:J(e)},e.web.request}function Le(){return Ge()}const z=Symbol("$HTTPEvent");function Ue(e){return typeof e=="object"&&(e instanceof L||e?.[z]instanceof L||e?.__is_event__===!0)}function u(e){return function(...s){let t=s[0];if(Ue(t))s[0]=t instanceof L||t.__is_event__?t:t[z];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(t=Le(),!t)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");s.unshift(t)}return e(...s)}}const J=u(ve),Fe=u(de),S=u(we),_=u(he),Oe=u(me),R=u(be),j=u(ye),Ie=u(Se),K=u(He),_e=u(fe),je=u(ge),De=u(Re),y=u(Ce),Me=u($e),We=u(xe),Ne=u(Ee);function Be(){return qe("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:Te})}function Ge(){return Be().use().event}const x="Invariant Violation",{setPrototypeOf:Xe=function(e,s){return e.__proto__=s,e}}=Object;class U extends Error{framesToPop=1;name=x;constructor(s=x){super(typeof s=="number"?`${x}: ${s} (see https://github.com/apollographql/invariant-packages)`:s),Xe(this,U.prototype)}}function ze(e,s){if(!e)throw new U(s)}const b="solidFetchEvent";function Je(e){return{request:Ne(e),response:Ye(e),clientAddress:Fe(e),locals:{},nativeEvent:e}}function Ke(e){return{...e}}function Ve(e){if(!e.context[b]){const s=Je(e);e.context[b]=s}return e.context[b]}function D(e,s){for(const[t,n]of s.entries())K(e,t,n)}class Qe{event;constructor(s){this.event=s}get(s){const t=j(this.event,s);return Array.isArray(t)?t.join(", "):t||null}has(s){return this.get(s)!==null}set(s,t){return Ie(this.event,s,t)}delete(s){return We(this.event,s)}append(s,t){K(this.event,s,t)}getSetCookie(){const s=j(this.event,"Set-Cookie");return Array.isArray(s)?s:[s]}forEach(s){return Object.entries(R(this.event)).forEach(([t,n])=>s(Array.isArray(n)?n.join(", "):n,t,this))}entries(){return Object.entries(R(this.event)).map(([s,t])=>[s,Array.isArray(t)?t.join(", "):t])[Symbol.iterator]()}keys(){return Object.keys(R(this.event))[Symbol.iterator]()}values(){return Object.values(R(this.event)).map(s=>Array.isArray(s)?s.join(", "):s)[Symbol.iterator]()}[Symbol.iterator](){return this.entries()[Symbol.iterator]()}}function Ye(e){return{get status(){return _(e)},set status(s){S(e,s)},get statusText(){return Oe(e)},set statusText(s){S(e,_(e),s)},headers:new Qe(e)}}const V=[{page:!0,$component:{src:"src/routes/activity/index.tsx?pick=default&pick=$css",build:()=>import("../index.js"),import:()=>import("../index.js")},path:"/activity/",filePath:"C:/Users/AlexH/Documents/GitHub/SoLaRiCodex/src/routes/activity/index.tsx"},{page:!0,$component:{src:"src/routes/index.tsx?pick=default&pick=$css",build:()=>import("../index2.js"),import:()=>import("../index2.js")},path:"/",filePath:"C:/Users/AlexH/Documents/GitHub/SoLaRiCodex/src/routes/index.tsx"},{page:!0,$component:{src:"src/routes/movies/index.tsx?pick=default&pick=$css",build:()=>import("../index3.js"),import:()=>import("../index3.js")},path:"/movies/",filePath:"C:/Users/AlexH/Documents/GitHub/SoLaRiCodex/src/routes/movies/index.tsx"},{page:!0,$component:{src:"src/routes/music/index.tsx?pick=default&pick=$css",build:()=>import("../index4.js"),import:()=>import("../index4.js")},path:"/music/",filePath:"C:/Users/AlexH/Documents/GitHub/SoLaRiCodex/src/routes/music/index.tsx"},{page:!0,$component:{src:"src/routes/search/index.tsx?pick=default&pick=$css",build:()=>import("../index5.js"),import:()=>import("../index5.js")},path:"/search/",filePath:"C:/Users/AlexH/Documents/GitHub/SoLaRiCodex/src/routes/search/index.tsx"},{page:!0,$component:{src:"src/routes/settings/index.tsx?pick=default&pick=$css",build:()=>import("../index6.js"),import:()=>import("../index6.js")},path:"/settings/",filePath:"C:/Users/AlexH/Documents/GitHub/SoLaRiCodex/src/routes/settings/index.tsx"},{page:!0,$component:{src:"src/routes/tv/index.tsx?pick=default&pick=$css",build:()=>import("../index7.js"),import:()=>import("../index7.js")},path:"/tv/",filePath:"C:/Users/AlexH/Documents/GitHub/SoLaRiCodex/src/routes/tv/index.tsx"}],Ze=et(V.filter(e=>e.page));function et(e){function s(t,n,o,a){const i=Object.values(t).find(c=>o.startsWith(c.id+"/"));return i?(s(i.children||(i.children=[]),n,o.slice(i.id.length)),t):(t.push({...n,id:o,path:o.replace(/\([^)/]+\)/g,"").replace(/\/+/g,"/")}),t)}return e.sort((t,n)=>t.path.length-n.path.length).reduce((t,n)=>s(t,n,n.path,n.path),[])}function tt(e){return e.$HEAD||e.$GET||e.$POST||e.$PUT||e.$PATCH||e.$DELETE}Ae({routes:V.reduce((e,s)=>{if(!tt(s))return e;let t=s.path.replace(/\([^)/]+\)/g,"").replace(/\/+/g,"/").replace(/\*([^/]*)/g,(n,o)=>`**:${o}`).split("/").map(n=>n.startsWith(":")||n.startsWith("*")?n:encodeURIComponent(n)).join("/");if(/:[^/]*\?/g.test(t))throw new Error(`Optional parameters are not supported in API routes: ${t}`);if(e[t])throw new Error(`Duplicate API routes for "${t}" found at "${e[t].route.path}" and "${s.path}"`);return e[t]={route:s},e},{})});function st(e){e.forEach(s=>{if(!s.attrs.href)return;let t=document.head.querySelector(`link[href="${s.attrs.href}"]`);t||(t=document.createElement("link"),t.setAttribute("rel","preload"),t.setAttribute("as","style"),t.setAttribute("href",s.attrs.href),document.head.appendChild(t))})}var rt=" ";const nt={style:e=>g("style",e.attrs,()=>e.children,!0),link:e=>g("link",e.attrs,void 0,!0),script:e=>e.attrs.src?g("script",ie(()=>e.attrs,{get id(){return e.key}}),()=>ce(rt),!0):null,noscript:e=>g("noscript",e.attrs,()=>ae(e.children),!0)};function ot(e,s){let{tag:t,attrs:{key:n,...o}={key:void 0},children:a}=e;return nt[t]({attrs:{...o,nonce:s},key:n,children:a})}function at(e,s,t,n="default"){return ne(async()=>{{const a=(await e.import())[n],c=(await s.inputs?.[e.src].assets()).filter(p=>p.tag==="style"||p.attrs.rel==="stylesheet");return typeof window<"u"&&st(c),{default:p=>[...c.map(h=>ot(h)),oe(a,p)]}}})}function Q(){function e(t){return{...t,...t.$$route?t.$$route.require().route:void 0,info:{...t.$$route?t.$$route.require().route.info:{},filesystem:!0},component:t.$component&&at(t.$component,globalThis.MANIFEST.client,globalThis.MANIFEST.ssr),children:t.children?t.children.map(e):void 0}}return Ze.map(e)}let M;const Ht=ue?()=>le().routes:()=>M||(M=Q());function it(e){const s=je(e.nativeEvent,"flash");if(s)try{let t=JSON.parse(s);if(!t||!t.result)return;const n=[...t.input.slice(0,-1),new Map(t.input[t.input.length-1])],o=t.error?new Error(t.result):t.result;return{input:n,url:t.url,pending:!1,result:t.thrown?void 0:o,error:t.thrown?o:void 0}}catch(t){console.error(t)}finally{De(e.nativeEvent,"flash","",{maxAge:0})}}async function ct(e){const s=globalThis.MANIFEST.client;return globalThis.MANIFEST.ssr,e.response.headers.set("Content-Type","text/html"),Object.assign(e,{manifest:await s.json(),assets:[...await s.inputs[s.handler].assets()],router:{submission:it(e)},routes:Q(),complete:!1,$islands:new Set})}const ut=new Set([301,302,303,307,308]);function lt(e){return e.status&&ut.has(e.status)?e.status:302}const pt={};function dt(e){const s=new TextEncoder().encode(e),t=s.length,n=t.toString(16),o="00000000".substring(0,8-n.length)+n,a=new TextEncoder().encode(`;0x${o};`),i=new Uint8Array(12+t);return i.set(a),i.set(s,12),i}function W(e,s){return new ReadableStream({start(t){se(s,{scopeId:e,plugins:[$,w,H,C,k,q,T,A,P,E],onSerialize(n,o){t.enqueue(dt(o?`(${re(e)},${n})`:n))},onDone(){t.close()},onError(n){t.error(n)}})}})}async function ft(e){const s=Ve(e),t=s.request,n=t.headers.get("X-Server-Id"),o=t.headers.get("X-Server-Instance"),a=t.headers.has("X-Single-Flight"),i=new URL(t.url);let c,d;if(n)ze(typeof n=="string","Invalid server function"),[c,d]=n.split("#");else if(c=i.searchParams.get("id"),d=i.searchParams.get("name"),!c||!d)return new Response(null,{status:404});const p=pt[c];let h;if(!p)return new Response(null,{status:404});h=await p.importer();const Y=h[p.functionName];let f=[];if(!o||e.method==="GET"){const r=i.searchParams.get("args");if(r){const l=JSON.parse(r);(l.t?I(l,{plugins:[$,w,H,C,k,q,T,A,P,E]}):l).forEach(m=>f.push(m))}}if(e.method==="POST"){const r=t.headers.get("content-type"),l=e.node.req,m=l instanceof ReadableStream,Z=l.body instanceof ReadableStream,F=m&&l.locked||Z&&l.body.locked,O=m?l:l.body;if(r?.startsWith("multipart/form-data")||r?.startsWith("application/x-www-form-urlencoded"))f.push(await(F?t:new Request(t,{...t,body:O})).formData());else if(r?.startsWith("application/json")){const ee=F?t:new Request(t,{...t,body:O});f=I(await ee.json(),{plugins:[$,w,H,C,k,q,T,A,P,E]})}}try{let r=await X(s,async()=>(G.context={event:s},s.locals.serverFunctionMeta={id:c+"#"+d},Y(...f)));if(a&&o&&(r=await B(s,r)),r instanceof Response){if(r.headers&&r.headers.has("X-Content-Raw"))return r;o&&(r.headers&&D(e,r.headers),r.status&&(r.status<300||r.status>=400)&&S(e,r.status),r.customBody?r=await r.customBody():r.body==null&&(r=null))}return o?(y(e,"content-type","text/javascript"),W(o,r)):N(r,t,f)}catch(r){if(r instanceof Response)a&&o&&(r=await B(s,r)),r.headers&&D(e,r.headers),r.status&&(!o||r.status<300||r.status>=400)&&S(e,r.status),r.customBody?r=r.customBody():r.body==null&&(r=null),y(e,"X-Error","true");else if(o){const l=r instanceof Error?r.message:typeof r=="string"?r:"true";y(e,"X-Error",l.replace(/[\r\n]+/g,""))}else r=N(r,t,f,!0);return o?(y(e,"content-type","text/javascript"),W(o,r)):r}}function N(e,s,t,n){const o=new URL(s.url),a=e instanceof Error;let i=302,c;return e instanceof Response?(c=new Headers(e.headers),e.headers.has("Location")&&(c.set("Location",new URL(e.headers.get("Location"),o.origin+"").toString()),i=lt(e))):c=new Headers({Location:new URL(s.headers.get("referer")).toString()}),e&&c.append("Set-Cookie",`flash=${encodeURIComponent(JSON.stringify({url:o.pathname+o.search,result:a?e.message:e,thrown:n,error:a,input:[...t.slice(0,-1),[...t[t.length-1].entries()]]}))}; Secure; HttpOnly;`),new Response(null,{status:i,headers:c})}let v;function ht(e){const s=new Headers(e.request.headers),t=_e(e.nativeEvent),n=e.response.headers.getSetCookie();s.delete("cookie");let o=!1;return e.nativeEvent.node?.req&&(o=!0,e.nativeEvent.node.req.headers.cookie=""),n.forEach(a=>{if(!a)return;const{maxAge:i,expires:c,name:d,value:p}=te(a);if(i!=null&&i<=0){delete t[d];return}if(c!=null&&c.getTime()<=Date.now()){delete t[d];return}t[d]=p}),Object.entries(t).forEach(([a,i])=>{s.append("cookie",`${a}=${i}`),o&&(e.nativeEvent.node.req.headers.cookie+=`${a}=${i};`)}),s}async function B(e,s){let t,n=new URL(e.request.headers.get("referer")).toString();s instanceof Response&&(s.headers.has("X-Revalidate")&&(t=s.headers.get("X-Revalidate").split(",")),s.headers.has("Location")&&(n=new URL(s.headers.get("Location"),new URL(e.request.url).origin+"").toString()));const o=Ke(e);return o.request=new Request(n,{headers:ht(e)}),await X(o,async()=>{await ct(o),v||(v=(await import("./app-BwPfAnN8.js")).default),o.router.dataOnly=t||!0,o.router.previousUrl=e.request.headers.get("referer");try{pe(()=>{G.context.event=o,v()})}catch(c){console.log(c)}const a=o.router.data;if(!a)return s;let i=!1;for(const c in a)a[c]===void 0?delete a[c]:i=!0;return i&&(s instanceof Response?s.customBody&&(a._$value=s.customBody()):(a._$value=s,s=new Response(null,{status:200})),s.customBody=()=>a,s.headers.set("X-Single-Flight","true")),s})}const Ct=ke(ft);export{Ht as F,Ct as h};
